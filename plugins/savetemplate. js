const fs = require('fs');
const path = require('path');
const { cmd } = require('../command');

const DATA_PATH = path.resolve(__dirname, '../data/send_data.json');
if (!fs.existsSync(DATA_PATH)) {
    fs.writeFileSync(DATA_PATH, JSON.stringify({ templates: {}, sentToday: [], dailyCount: 0, lastReset: Date.now(), reports: [] }, null, 2));
}
let store = JSON.parse(fs.readFileSync(DATA_PATH));

function saveStore() {
    fs.writeFileSync(DATA_PATH, JSON.stringify(store, null, 2));
}

cmd({
    pattern: "savetemplate",
    react: "💾",
    desc: "Save a broadcast message template",
    category: "owner",
    use: ".savetemplate <name> | <message>",
    filename: __filename
}, async (conn, mek, m, { q, isCreator, reply }) => {
    if (!isCreator) return reply("🚫 Owner only.");
    if (!q.includes('|')) return reply("❗ Usage: `.savetemplate <name> | <message>`");

    const [name, content] = q.split('|').map(s => s.trim());
    store.templates[name] = content;
    saveStore();

    reply(`✅ Template "${name}" saved!`);
});
